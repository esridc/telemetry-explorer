import{r as t,c as e,h as i,H as n}from"./p-ce275af6.js";import{s as r}from"./p-f300bd24.js";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var s=function(){s=Object.assign||function t(e){for(var i,n=1,r=arguments.length;n<r;n++){i=arguments[n];for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s))e[s]=i[s]}return e};return s.apply(this,arguments)};function o(t){return Object.keys(t).some((e=>{let i=t[e];if(!i){return false}if(i&&i.toParam){i=i.toParam()}const n=i.constructor.name;switch(n){case"Array":return false;case"Object":return false;case"Date":return false;case"Function":return false;case"Boolean":return false;case"String":return false;case"Number":return false;default:return true}}))}function a(t){const e={};Object.keys(t).forEach((i=>{var n,r;let s=t[i];if(s&&s.toParam){s=s.toParam()}if(!s&&s!==0&&typeof s!=="boolean"&&typeof s!=="string"){return}const o=s.constructor.name;let a;switch(o){case"Array":const t=(r=(n=s[0])===null||n===void 0?void 0:n.constructor)===null||r===void 0?void 0:r.name;a=t==="Array"?s:t==="Object"?JSON.stringify(s):s.join(",");break;case"Object":a=JSON.stringify(s);break;case"Date":a=s.valueOf();break;case"Function":a=null;break;case"Boolean":a=s+"";break;default:a=s;break}if(a||a===0||typeof a==="string"||Array.isArray(a)){e[i]=a}}));return e}function c(t,e){if(Array.isArray(e)&&e[0]&&Array.isArray(e[0])){return e.map((e=>c(t,e))).join("&")}return encodeURIComponent(t)+"="+encodeURIComponent(e)}function u(t){const e=a(t);return Object.keys(e).map((t=>c(t,e[t]))).join("&")}var h={FormData:globalThis.FormData,File:globalThis.File,Blob:globalThis.Blob};function l(t,e){const i=o(t)||e;const n=a(t);if(i){const t=new h.FormData;Object.keys(n).forEach((e=>{if(typeof Blob!=="undefined"&&n[e]instanceof Blob){const i=n["fileName"]||n[e].name||e;t.append(e,n[e],i)}else{t.append(e,n[e])}}));return t}else{return u(t)}}class f extends Error{constructor(t,e,i,n,r){super(t);const s=new.target.prototype;Object.setPrototypeOf(this,s);t=t||"UNKNOWN_ERROR";e=e||"UNKNOWN_ERROR_CODE";this.name="ArcGISRequestError";this.message=e==="UNKNOWN_ERROR_CODE"?t:`${e}: ${t}`;this.originalMessage=t;this.code=e;this.response=i;this.url=n;this.options=r}}function d(t){if(console&&console.warn){console.warn.apply(console,[t])}}var p=function t(){return Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.request})};const g=`@esri/arcgis-rest-js`;function w(){return globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}}}class m extends f{constructor(t="AUTHENTICATION_ERROR",e="AUTHENTICATION_ERROR_CODE",i,n,r){super(t,e,i,n,r);this.name="ArcGISAuthError";this.message=e==="AUTHENTICATION_ERROR_CODE"?t:`${e}: ${t}`;const s=new.target.prototype;Object.setPrototypeOf(this,s)}retry(t,e=1){let i=0;const n=(r,s)=>{i=i+1;t(this.url,this.options).then((t=>{const e=Object.assign(Object.assign({},this.options),{authentication:t});return b(this.url,e)})).then((t=>{r(t)})).catch((t=>{if(t.name==="ArcGISAuthError"&&i<e){n(r,s)}else if(t.name===this.name&&t.message===this.message&&i>=e){s(this)}else{s(t)}}))};return new Promise(((t,e)=>{n(t,e)}))}}function v(t,e,i,n,r){if(t.code>=400){const{message:i,code:r}=t;throw new f(i,r,t,e,n)}if(t.error){const{message:i,code:s,messageCode:o}=t.error;const a=o||s||"UNKNOWN_ERROR_CODE";if(s===498||s===499){if(r){throw r}else{throw new m(i,a,t,e,n)}}throw new f(i,a,t,e,n)}if(t.status==="failed"||t.status==="failure"){let i;let r="UNKNOWN_ERROR_CODE";try{i=JSON.parse(t.statusMessage).message;r=JSON.parse(t.statusMessage).code}catch(e){i=t.statusMessage||t.message}throw new f(i,r,t,e,n)}return t}function b(t,e){const i=w();const n=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},i),e),{params:Object.assign(Object.assign({},i.params),e.params),headers:Object.assign(Object.assign({},i.headers),e.headers)});const{httpMethod:r,rawResponse:s}=n;const a=Object.assign({f:"json"},n.params);let c=null;const h={method:r,signal:n.signal,credentials:n.credentials||"same-origin"};if(n.headers&&n.headers["X-Esri-Auth-Client-Id"]&&t.indexOf("/oauth2/platformSelf")>-1){h.credentials="include"}let m;if(typeof n.authentication==="string"){const t=n.authentication;m={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(t)};if(!n.authentication.startsWith("AAPK")&&!n.authentication.startsWith("AATK")&&!n.suppressWarnings&&!globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING){d(`Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information.`);globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=true}}else{m=n.authentication}const b=t;return(m?m.getToken(t).catch((e=>{e.url=t;e.options=n;c=e;return Promise.resolve("")})):Promise.resolve("")).then((e=>{if(e.length){a.token=e}if(m&&m.getDomainCredentials){h.credentials=m.getDomainCredentials(t)}const i={};if(h.method==="GET"){if(a.token&&n.hideToken&&typeof window==="undefined"){i["X-Esri-Authorization"]=`Bearer ${a.token}`;delete a.token}const r=u(a);const s=r===""?t:t+"?"+u(a);if(n.maxUrlLength&&s.length>n.maxUrlLength||a.token&&n.hideToken){h.method="POST";if(e.length&&n.hideToken){a.token=e;delete i["X-Esri-Authorization"]}}else{t=s}}const r=new RegExp("/items/.+/updateResources").test(t);if(h.method==="POST"){h.body=l(a,r)}h.headers=Object.assign(Object.assign({},i),n.headers);if((typeof window==="undefined"||window&&typeof window.document==="undefined")&&!h.headers.referer){h.headers.referer=g}if(!o(a)&&!r){h.headers["Content-Type"]="application/x-www-form-urlencoded"}return globalThis.fetch?globalThis.fetch(t,h):p().then((({fetch:e})=>e(t,h)))})).then((e=>{if(!e.ok){return e.json().then((i=>{const{status:r,statusText:s}=e;const{message:o,details:a}=i.error;const c=`${o}. ${a?a.join(" "):""}`.trim();throw new f(c,`HTTP ${r} ${s}`,i,t,n)})).catch((i=>{if(i.name==="ArcGISRequestError"){throw i}const{status:r,statusText:s}=e;throw new f(s,`HTTP ${r}`,e,t,n)}))}if(s){return e}switch(a.f){case"json":return e.json();case"geojson":return e.json();case"html":return e.text();case"text":return e.text();default:return e.blob()}})).then((e=>{if((a.f==="json"||a.f==="geojson")&&!s){const i=v(e,b,a,n,c);if(c){const e=t.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];n.authentication.federatedServers[e]={token:[],expires:new Date(Date.now()+86400*1e3)};c=null}return i}else{return e}}))}function y(t,e={params:{f:"json"}}){return b(t,e).catch((t=>{if(t instanceof m&&e.authentication&&typeof e.authentication!=="string"&&e.authentication.canRefresh&&e.authentication.refreshCredentials){return t.retry((()=>e.authentication.refreshCredentials()),1)}else{return Promise.reject(t)}}))}function O(t){if(typeof t!=="string"){return t}t=t.trim();if(t[t.length-1]==="/"){t=t.slice(0,-1)}return t}function T(t){const[e,i]=t.split("=");return{key:decodeURIComponent(e),value:decodeURIComponent(i)}}function S(t){if(!t||t.length<=0){return{}}return t.replace(/^#/,"").replace(/^\?/,"").split("&").reduce(((t,e)=>{const{key:i,value:n}=T(e);t[i]=n;return t}),{})}function E(t,e){var i=e;i.rawResponse=false;return y(t,i).then((function(t){var e={token:t.access_token,username:t.username,expires:new Date(Date.now()+(t.expires_in*1e3-1e3)),ssl:t.ssl===true};if(t.refresh_token){e.refreshToken=t.refresh_token}return e}))}function k(t,e){var i=e;if(typeof window!=="undefined"&&window.location&&window.location.host){i.params.referer=window.location.host}else{i.params.referer=g}return y(t,i)}var x=/^https?:\/\/(\S+)\.arcgis\.com.+/;function A(t){return x.test(t)}function R(t){if(!x.test(t)){return t}switch(_(t)){case"dev":return"https://devext.arcgis.com/sharing/rest";case"qa":return"https://qaext.arcgis.com/sharing/rest";default:return"https://www.arcgis.com/sharing/rest"}}function _(t){if(!x.test(t)){return null}var e=t.match(x);var i=e[1].split(".").pop();if(i.includes("dev")){return"dev"}if(i.includes("qa")){return"qa"}return"production"}function I(t,e){var i=O(R(e)).replace(/https?:\/\//,"");var n=O(t).replace(/https?:\/\//,"");return new RegExp(n,"i").test(i)}function j(t,e){var i=A(t);var n=A(e);var r=_(t);var s=_(e);if(i&&n&&r===s){return true}return false}function D(t,e,i){if(i===void 0){i="https://www.arcgis.com/sharing/rest"}var n=i+"/oauth2/validateAppAccess";var r={method:"POST",params:{f:"json",client_id:e,token:t}};return y(n,r)}function U(){var t={promise:null,resolve:null,reject:null};t.promise=new Promise((function(e,i){t.resolve=e;t.reject=i}));return t}var N=function(){function t(t){this.clientId=t.clientId;this._refreshToken=t.refreshToken;this._refreshTokenExpires=t.refreshTokenExpires;this.username=t.username;this.password=t.password;this._token=t.token;this._tokenExpires=t.tokenExpires;this.portal=t.portal?O(t.portal):"https://www.arcgis.com/sharing/rest";this.ssl=t.ssl;this.provider=t.provider||"arcgis";this.tokenDuration=t.tokenDuration||20160;this.redirectUri=t.redirectUri;this.refreshTokenTTL=t.refreshTokenTTL||1440;this.trustedServers={};if(t.server){var e=this.getServerRootUrl(t.server);this.trustedServers[e]={token:t.token,expires:t.tokenExpires}}this._pendingTokenRequests={}}Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:false,configurable:true});t.beginOAuth2=function(e,i){if(i===void 0){i=window}var n=s({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",duration:20160,popup:true,popupWindowFeatures:"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes",state:e.clientId,locale:""},e),r=n.portal,o=n.provider,a=n.clientId,c=n.duration,h=n.redirectUri,l=n.popup,f=n.popupWindowFeatures,d=n.state,p=n.locale,g=n.params;var w;if(o==="arcgis"){w=r+"/oauth2/authorize?client_id="+a+"&response_type=token&expiration="+c+"&redirect_uri="+encodeURIComponent(h)+"&state="+d+"&locale="+p}else{w=r+"/oauth2/social/authorize?client_id="+a+"&socialLoginProviderName="+o+"&autoAccountCreateForSocial=true&response_type=token&expiration="+c+"&redirect_uri="+encodeURIComponent(h)+"&state="+d+"&locale="+p}if(g){w=w+"&"+u(g)}if(!l){i.location.href=w;return undefined}var v=U();i["__ESRI_REST_AUTH_HANDLER_"+a]=function(e,i){if(e){var n=JSON.parse(e);v.reject(new m(n.errorMessage,n.error));return}if(i){var s=JSON.parse(i);v.resolve(new t({clientId:a,portal:r,ssl:s.ssl,token:s.token,tokenExpires:new Date(s.expires),username:s.username}))}};i.open(w,"oauth-window",f);return v.promise};t.completeOAuth2=function(e,i){if(i===void 0){i=window}var n=s({portal:"https://www.arcgis.com/sharing/rest",popup:true},e),r=n.portal,o=n.clientId,a=n.popup;function c(e,n){try{var s=void 0;var c="__ESRI_REST_AUTH_HANDLER_"+o;if(a){if(i.opener){if(i.opener.parent&&i.opener.parent[c]){s=i.opener.parent[c]}else if(i.opener&&i.opener[c]){s=i.opener[c]}}else{if(i!==i.parent&&i.parent&&i.parent[c]){s=i.parent[c]}}if(s){s(e?JSON.stringify(e):undefined,JSON.stringify(n));i.close();return undefined}}}catch(t){throw new m('Unable to complete authentication. It\'s possible you specified popup based oAuth2 but no handler from "beginOAuth2()" present. This generally happens because the "popup" option differs between "beginOAuth2()" and "completeOAuth2()".')}if(e){throw new m(e.errorMessage,e.error)}return new t({clientId:o,portal:r,ssl:n.ssl,token:n.token,tokenExpires:n.expires,username:n.username})}var u=S(i.location.hash);if(!u.access_token){var h=void 0;var l="Unknown error";if(u.error){h=u.error;l=u.error_description}return c({error:h,errorMessage:l})}var f=u.access_token;var d=new Date(Date.now()+parseInt(u.expires_in,10)*1e3-60*1e3);var p=u.username;var g=u.ssl==="true";return c(undefined,{token:f,expires:d,ssl:g,username:p})};t.fromParent=function(e,i){if(!i&&window){i=window}var n;return new Promise((function(r,s){n=function(i){if(i.origin===e){try{return r(t.parentMessageHandler(i))}catch(t){return s(t)}}};i.addEventListener("message",n,false);i.parent.postMessage({type:"arcgis:auth:requestCredential"},e)})).then((function(t){i.removeEventListener("message",n,false);return t}))};t.authorize=function(t,e){var i=s({portal:"https://arcgis.com/sharing/rest",duration:20160},t),n=i.portal,r=i.clientId,o=i.duration,a=i.redirectUri;e.writeHead(301,{Location:n+"/oauth2/authorize?client_id="+r+"&duration="+o+"&response_type=code&redirect_uri="+encodeURIComponent(a)});e.end()};t.exchangeAuthorizationCode=function(e,i){var n=s({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:1440},e),r=n.portal,o=n.clientId,a=n.redirectUri,c=n.refreshTokenTTL;return E(r+"/oauth2/token",{params:{grant_type:"authorization_code",client_id:o,redirect_uri:a,code:i}}).then((function(e){return new t({clientId:o,portal:r,ssl:e.ssl,redirectUri:a,refreshToken:e.refreshToken,refreshTokenTTL:c,refreshTokenExpires:new Date(Date.now()+(c-1)*1e3),token:e.token,tokenExpires:e.expires,username:e.username})}))};t.deserialize=function(e){var i=JSON.parse(e);return new t({clientId:i.clientId,refreshToken:i.refreshToken,refreshTokenExpires:new Date(i.refreshTokenExpires),username:i.username,password:i.password,token:i.token,tokenExpires:new Date(i.tokenExpires),portal:i.portal,ssl:i.ssl,tokenDuration:i.tokenDuration,redirectUri:i.redirectUri,refreshTokenTTL:i.refreshTokenTTL})};t.fromCredential=function(e){return new t({portal:e.server.includes("sharing/rest")?e.server:e.server+"/sharing/rest",ssl:e.ssl,token:e.token,username:e.userId,tokenExpires:new Date(e.expires)})};t.parentMessageHandler=function(e){if(e.data.type==="arcgis:auth:credential"){return t.fromCredential(e.data.credential)}if(e.data.type==="arcgis:auth:rejected"){throw new Error(e.data.message)}else{throw new Error("Unknown message type.")}};t.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}};t.prototype.getUser=function(t){var e=this;if(this._pendingUserRequest){return this._pendingUserRequest}else if(this._user){return Promise.resolve(this._user)}else{var i=this.portal+"/community/self";var n=s(s({httpMethod:"GET",authentication:this},t),{rawResponse:false});this._pendingUserRequest=y(i,n).then((function(t){e._user=t;e._pendingUserRequest=null;return t}));return this._pendingUserRequest}};t.prototype.getUsername=function(){if(this.username){return Promise.resolve(this.username)}else if(this._user){return Promise.resolve(this._user.username)}else{return this.getUser().then((function(t){return t.username}))}};t.prototype.getToken=function(t,e){if(j(this.portal,t)){return this.getFreshToken(e)}else if(new RegExp(this.portal,"i").test(t)){return this.getFreshToken(e)}else{return this.getTokenForServer(t,e)}};t.prototype.validateAppAccess=function(t){return this.getToken(this.portal).then((function(e){return D(e,t)}))};t.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}};t.prototype.serialize=function(){return JSON.stringify(this)};t.prototype.enablePostMessageAuth=function(t,e){if(!e&&window){e=window}this._hostHandler=this.createPostMessageHandler(t);e.addEventListener("message",this._hostHandler,false)};t.prototype.disablePostMessageAuth=function(t){if(!t&&window){t=window}t.removeEventListener("message",this._hostHandler,false)};t.prototype.refreshSession=function(t){this._user=null;if(this.username&&this.password){return this.refreshWithUsernameAndPassword(t)}if(this.clientId&&this.refreshToken){return this.refreshWithRefreshToken()}return Promise.reject(new m("Unable to refresh token."))};t.prototype.getServerRootUrl=function(t){var e=O(t).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/)[0];var i=e.match(/(https?:\/\/)(.+)/),n=i[1],r=i[2];var s=r.split("/"),o=s[0],a=s.slice(1);return""+n+o.toLowerCase()+"/"+a.join("/")};t.prototype.createPostMessageHandler=function(t){var e=this;return function(i){if(t.indexOf(i.origin)>-1){var n=e.toCredential();i.source.postMessage({type:"arcgis:auth:credential",credential:n},i.origin)}else{i.source.postMessage({type:"arcgis:auth:rejected",message:"Rejected authentication request."},i.origin)}}};t.prototype.getTokenForServer=function(t,e){var i=this;var n=this.getServerRootUrl(t);var r=this.trustedServers[n];if(r&&r.expires&&r.expires.getTime()>Date.now()){return Promise.resolve(r.token)}if(this._pendingTokenRequests[n]){return this._pendingTokenRequests[n]}this._pendingTokenRequests[n]=y(n+"/rest/info").then((function(r){if(r.owningSystemUrl){if(!I(r.owningSystemUrl,i.portal)){throw new m(t+" is not federated with "+i.portal+".","NOT_FEDERATED")}else{return y(r.owningSystemUrl+"/sharing/rest/info",e)}}else if(r.authInfo&&i.trustedServers[n]!==undefined){return Promise.resolve({authInfo:r.authInfo})}else{throw new m(t+" is not federated with any portal and is not explicitly trusted.","NOT_FEDERATED")}})).then((function(t){return t.authInfo.tokenServicesUrl})).then((function(e){if(i.token&&i.tokenExpires.getTime()>Date.now()){return k(e,{params:{token:i.token,serverUrl:t,expiration:i.tokenDuration,client:"referer"}})}else{return k(e,{params:{username:i.username,password:i.password,expiration:i.tokenDuration,client:"referer"}}).then((function(t){i._token=t.token;i._tokenExpires=new Date(t.expires);return t}))}})).then((function(t){i.trustedServers[n]={expires:new Date(t.expires),token:t.token};delete i._pendingTokenRequests[n];return t.token}));return this._pendingTokenRequests[n]};t.prototype.getFreshToken=function(t){var e=this;if(this.token&&!this.tokenExpires){return Promise.resolve(this.token)}if(this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()){return Promise.resolve(this.token)}if(!this._pendingTokenRequests[this.portal]){this._pendingTokenRequests[this.portal]=this.refreshSession(t).then((function(t){e._pendingTokenRequests[e.portal]=null;return t.token}))}return this._pendingTokenRequests[this.portal]};t.prototype.refreshWithUsernameAndPassword=function(t){var e=this;var i=s({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},t);return k(this.portal+"/generateToken",i).then((function(t){e._token=t.token;e._tokenExpires=new Date(t.expires);return e}))};t.prototype.refreshWithRefreshToken=function(t){var e=this;if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now()){return this.refreshRefreshToken(t)}var i=s({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},t);return E(this.portal+"/oauth2/token",i).then((function(t){e._token=t.token;e._tokenExpires=t.expires;return e}))};t.prototype.refreshRefreshToken=function(t){var e=this;var i=s({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},t);return E(this.portal+"/oauth2/token",i).then((function(t){e._token=t.token;e._tokenExpires=t.expires;e._refreshToken=t.refreshToken;e._refreshTokenExpires=new Date(Date.now()+(e.refreshTokenTTL-1)*60*1e3);return e}))};return t}();const P=(t,e)=>e.split(".").reduce((function(e,i){const n=i.match(/\[(.*?)\]$/);if(n){const t=n[1];const r=i.replace(n[0],"");if(parseInt(t,10)>-1){const i=parseInt(t,10);if(Array.isArray(e[r])&&e[r][i]){return e[r][i]}else{return undefined}}else{return $(e[r],t)}}else{if(e&&e[i]!==undefined){if(e[i]!==null&&e[i].$use){return P(t,e[i].$use)}else{return e[i]}}else{return undefined}}}),t);function $(t,e){const i=e.split("(");if(!i||i.length!==2)return undefined;let n;const r=i[0];const s=i[1].replace(")","").split(",").map((t=>t.trim()));switch(r){case"findBy":const e=s[0];let i;if(C(s[1])){i=parseFloat(s[1])}else{i=s[1].replace(/'/g,"")}n=t.find((t=>t[e]===i));break;default:n=undefined}return n}function C(t){return!isNaN(parseFloat(t))}function q(t){let e={};if(Array.isArray(t)){e=t.map(q)}else if(typeof t==="object"){for(const i in t){if(t.hasOwnProperty(i)){const n=t[i];if(n!=null&&typeof n==="object"){if(n instanceof Date){e[i]=new Date(n.getTime())}else if(typeof Blob!=="undefined"&&n instanceof Blob){e[i]=new Blob([n],{type:n.type})}else{e[i]=q(n)}}else{e[i]=n}}}}else{e=t}return e}function H(t,e,i){const n=P(t,e);return n!==undefined?n:i}function G(t){if(arguments.length===0){throw new TypeError("1 argument required, but only 0 present.")}t=`${t}`;t=t.replace(/[ \t\n\f\r]/g,"");if(t.length%4===0){t=t.replace(/==?$/,"")}if(t.length%4===1||/[^+/0-9A-Za-z]/.test(t)){return null}let e="";let i=0;let n=0;for(let r=0;r<t.length;r++){i<<=6;i|=M(t[r]);n+=6;if(n===24){e+=String.fromCharCode((i&16711680)>>16);e+=String.fromCharCode((i&65280)>>8);e+=String.fromCharCode(i&255);i=n=0}}if(n===12){i>>=4;e+=String.fromCharCode(i)}else if(n===18){i>>=2;e+=String.fromCharCode((i&65280)>>8);e+=String.fromCharCode(i&255)}return e}const L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function M(t){const e=L.indexOf(t);return e<0?undefined:e}var J=G;function B(t){if(arguments.length===0){throw new TypeError("1 argument required, but only 0 present.")}let e;t=`${t}`;for(e=0;e<t.length;e++){if(t.charCodeAt(e)>255){return null}}let i="";for(e=0;e<t.length;e+=3){const n=[undefined,undefined,undefined,undefined];n[0]=t.charCodeAt(e)>>2;n[1]=(t.charCodeAt(e)&3)<<4;if(t.length>e+1){n[1]|=t.charCodeAt(e+1)>>4;n[2]=(t.charCodeAt(e+1)&15)<<2}if(t.length>e+2){n[2]|=t.charCodeAt(e+2)>>6;n[3]=t.charCodeAt(e+2)&63}for(let t=0;t<n.length;t++){if(typeof n[t]==="undefined"){i+="="}else{i+=F(n[t])}}}return i}const z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function F(t){if(t>=0&&t<64){return z[t]}return undefined}var K=B;var W={atob:J,btoa:K};function Z(t){const e=W.atob(t);return Uint8Array.from(e,(t=>t.codePointAt(0)))}function Q(t){const e=Array.from(t,(t=>String.fromCodePoint(t))).join("");return W.btoa(e)}function V(t){return Q((new TextEncoder).encode(t))}function X(t){return(new TextDecoder).decode(Z(t))}var Y;(function(t){t[t["all"]=0]="all";t[t["debug"]=1]="debug";t[t["info"]=2]="info";t[t["warn"]=3]="warn";t[t["error"]=4]="error";t[t["off"]=5]="off"})(Y||(Y={}));class tt{static setLogLevel(t){this.logLevel=t}static log(t,...e){if(this.isLevelPermitted(Y.debug)){console.log(t,...e)}}static debug(t,...e){if(this.isLevelPermitted(Y.debug)){console.debug(t,...e)}}static info(t,...e){if(this.isLevelPermitted(Y.info)){console.info(t,...e)}}static warn(t,...e){if(this.isLevelPermitted(Y.warn)){console.warn(t,...e)}}static error(t,...e){if(this.isLevelPermitted(Y.error)){console.error(t,...e)}}static isLevelPermitted(t){return this.logLevel<=t}}tt.logLevel=Y.off;function et(t){let e="enterprise";if(t.includes("arcgis.com")){e="production"}if(t.includes("qaext.arcgis.com")||t.includes("mapsqa.arcgis.com")){e="qaext"}if(t.includes("devext.arcgis.com")||t.includes("mapsdev.arcgis.com")){e="devext"}return e}function it(t={}){if(t.portal){return O(t.portal)}if(t.authentication&&typeof t.authentication!=="string"){return t.authentication.portal}return"https://www.arcgis.com/sharing/rest"}function nt(t){let e;let i={httpMethod:"GET"};if(typeof t==="string"){e=`https://www.arcgis.com/sharing/rest/community/users/${t}`}else{const n=t.username||t.authentication.username;e=`${it(t)}/community/users/${encodeURIComponent(n)}`;i=Object.assign(Object.assign({},t),i)}return y(e,i)}function rt(t){return st(null,t)}function st(t,e){const i=t?t:"self";const n=`${it(e)}/portals/${i}`;const r=Object.assign({httpMethod:"GET"},e);return y(n,r)}function ot(t){let e;if(t.match(/(qaext|\.mapsqa)\.arcgis.com/)){e="https://hubqa.arcgis.com"}else if(t.match(/(devext|\.mapsdevext)\.arcgis.com/)){e="https://hubdev.arcgis.com"}else if(t.match(/(www|\.maps)\.arcgis.com/)){e="https://hub.arcgis.com"}return e}function at(t){let e=t;if(t.match(/(qaext|\.mapsqa)\.arcgis.com/)){e="https://qaext.arcgis.com"}else if(t.match(/(devext|\.mapsdevext)\.arcgis.com/)){e="https://devext.arcgis.com"}else{if(t.match(/(www|\.maps)\.arcgis.com/)){e="https://www.arcgis.com"}}return e}const ct={domains:"/api/v3/domains",search:"/api/v3/datasets",discussions:"/api/discussions/v1"};class ut{constructor(t){this._portalUrl="https://www.arcgis.com";this.id=t.id;this._portalUrl=t.portalUrl;this._hubUrl=t.hubUrl;this._systemStatus=t.systemStatus;this._serviceStatus=t.serviceStatus;if(t.authentication){this._authentication=t.authentication}if(t.portalSelf){this._portalSelf=t.portalSelf}if(t.currentUser){this._currentUser=t.currentUser}if(t.properties){this._properties=t.properties}}get session(){return this._authentication}get isAuthenticated(){return!!this._authentication}get isAlphaOrg(){var t,e;let i=false;const n=((t=this._properties)===null||t===void 0?void 0:t.alphaOrgs)||[];const r=(e=this._portalSelf)===null||e===void 0?void 0:e.id;if(n.length&&r){i=n.includes(r)}return i}get isBetaOrg(){var t,e;let i=false;const n=((t=this._properties)===null||t===void 0?void 0:t.betaOrgs)||[];const r=(e=this._portalSelf)===null||e===void 0?void 0:e.id;if(n.length&&r){i=n.includes(r)}return i}get environment(){return et(this._portalUrl)}get userRequestOptions(){if(this.isAuthenticated){return{authentication:this._authentication,portal:this.sharingApiUrl}}}get requestOptions(){let t={portal:this.sharingApiUrl};if(this.isAuthenticated){t={authentication:this._authentication,portal:this.sharingApiUrl}}return t}get hubRequestOptions(){return{authentication:this.session,isPortal:this.isPortal,portalSelf:this.portal,hubApiUrl:this.hubUrl,portal:this.sharingApiUrl}}get portalUrl(){if(this.isAuthenticated){if(this.isPortal||!this._portalSelf.urlKey){return`https://${this._portalSelf.portalHostname}`}else{return`https://${this._portalSelf.urlKey}.${this._portalSelf.customBaseUrl}`}}else{return this._portalUrl}}get hubHomeUrl(){if(this.isPortal){return undefined}else{if(this.isAuthenticated){const t=this._hubUrl.replace("https://","");return`https://${this._portalSelf.urlKey}.${t}`}else{return this._hubUrl}}}get hubLicense(){if(this.isPortal){return"enterprise-sites"}else{if(this.hubEnabled){return"hub-premium"}else{return"hub-basic"}}}get systemStatus(){console.warn(`DEPRECATED: context.systemStatus is deprecated use context.serviceStatus instead`);return this._systemStatus}get serviceStatus(){return this._serviceStatus}get sharingApiUrl(){return`${this.portalUrl}/sharing/rest`}get hubUrl(){return this._hubUrl}get isPortal(){return this._portalSelf?this._portalSelf.isPortal:this._portalUrl.indexOf("arcgis.com")===-1}get discussionsServiceUrl(){if(this._hubUrl){return`${this._hubUrl}${ct.discussions}`}}get hubSearchServiceUrl(){if(this._hubUrl){return`${this._hubUrl}${ct.search}`}}get domainServiceUrl(){if(this._hubUrl){return`${this._hubUrl}${ct.domains}`}}get eventsConfig(){if(this._portalSelf){return P(this._portalSelf,"portalProperties.hub.settings.events")}}get hubEnabled(){return H(this._portalSelf,"portalProperties.hub.enabled",false)}get communityOrgId(){if(this._portalSelf){return P(this._portalSelf,"portalProperties.hub.settings.communityOrg.orgId")}}get communityOrgHostname(){if(this._portalSelf){return P(this._portalSelf,"portalProperties.hub.settings.communityOrg.portalHostname")}}get communityOrgUrl(){if(this.communityOrgHostname){return`https://${this.communityOrgHostname}`}}get helperServices(){if(this._portalSelf){return this._portalSelf.helperServices}}get currentUser(){return this._currentUser}get portal(){return this._portalSelf}get properties(){return this._properties}}class ht{constructor(t){this._portalUrl="https://www.arcgis.com";this._logLevel=Y.error;this.id=(new Date).getTime();if(t.logLevel){this._logLevel=t.logLevel}tt.setLogLevel(this._logLevel);tt.debug(`ArcGISContextManager:ctor: Creating ${this.id}`);if(t.properties){this._properties=t.properties}if(t.authentication){this._authentication=t.authentication;this._portalUrl=this._authentication.portal.replace("/sharing/rest","");this._hubUrl=ot(this._portalUrl)}else if(t.portalUrl){this._portalUrl=t.portalUrl;this._hubUrl=ot(this._portalUrl)}else{this._hubUrl=ot(this._portalUrl)}if(t.portal){this._portalSelf=q(t.portal)}if(t.currentUser){this._currentUser=q(t.currentUser)}if(t.systemStatus){this._systemStatus=t.systemStatus}if(t.serviceStatus){this._serviceStatus=t.serviceStatus}}static async create(t={}){const e=new ht(t);await e.initialize();return e}static async deserialize(t){const e=X(t);const i=JSON.parse(e);const n={portalUrl:i.portalUrl};if(i.session){const t=N.deserialize(i.session);if(t.tokenExpires.getTime()>Date.now()){n.authentication=t;if(i.portal){n.portal=i.portal}if(i.currentUser){n.currentUser=i.currentUser}if(i.properties){n.properties=i.properties}}}else{n.portalUrl=i.portalUrl}n.systemStatus=i.systemStatus;n.serviceStatus=i.serviceStatus;return ht.create(n)}async setAuthentication(t){this._authentication=t;this._portalUrl=t.portal.replace("/sharing/rest","");await this.initialize()}setProperties(t){this._properties=t;this._context=new ut(this.contextOpts)}clearAuthentication(){if(!this._context.isPortal){this._portalUrl=at(this._portalUrl)}this._authentication=null;this._portalSelf=null;this._currentUser=null;this._context=new ut(this.contextOpts)}get context(){return this._context}serialize(){const t={portalUrl:this._portalUrl,systemStatus:this._systemStatus,serviceStatus:this._serviceStatus};if(this._authentication){t.session=this._authentication.serialize()}if(this._portalSelf){t.portal=this._portalSelf}if(this._currentUser){t.currentUser=this._currentUser}if(this._properties){t.properties=this._properties}return V(JSON.stringify(t))}async initialize(){if(this._authentication&&(!this._portalSelf||!this._currentUser)){tt.debug(`ArcGISContextManager-${this.id}: Initializing`);const t=this._authentication.username;const e=[rt({authentication:this._authentication}),nt({username:t,authentication:this._authentication})];try{const[t,i]=await Promise.all(e);this._portalSelf=t;this._currentUser=i;tt.debug(`ArcGISContextManager-${this.id}: received portalSelf and currentUser`)}catch(t){const e=`ArcGISContextManager could not fetch portal & user for "${this._authentication.username}" using ${this._authentication.portal}.`;tt.error(e);console.error(e);throw t}}if(!this._systemStatus){this._systemStatus=await lt(this._portalUrl)}if(!this._serviceStatus){this._serviceStatus=await pt(this._portalUrl)}tt.debug(`ArcGISContextManager-${this.id}: updating context`);this._context=new ut(this.contextOpts)}get contextOpts(){const t={id:this.id,portalUrl:this._portalUrl,hubUrl:this._hubUrl,properties:this._properties,systemStatus:this._systemStatus,serviceStatus:this._serviceStatus};if(this._authentication){t.authentication=this._authentication}if(this._portalSelf){t.portalSelf=this._portalSelf}if(this._currentUser){t.currentUser=this._currentUser}return t}}function lt(t){let e=dt;const i=t.indexOf("arcgis.com")===-1;if(i){e=ft}return Promise.resolve(e)}const ft={content:"online",discussions:"not-available",events:"not-available",initiatives:"not-available",items:"online",metrics:"not-available",notifications:"not-available",pages:"online",projects:"not-available",search:"online",sites:"online",groups:"online",platform:"online"};const dt={content:"online",discussions:"online",events:"online",initiatives:"online",items:"online",metrics:"online",notifications:"online",pages:"online",projects:"online",search:"online",sites:"online",groups:"online",platform:"online"};function pt(t){let e=gt;const i=t.indexOf("arcgis.com")===-1;if(i){e=wt}return Promise.resolve(e)}const gt={portal:"online",discussions:"online",events:"online",metrics:"online",notifications:"online","hub-search":"online",domains:"online"};const wt={portal:"online",discussions:"not-available",events:"not-available",metrics:"not-available",notifications:"not-available","hub-search":"not-available",domains:"not-available"};const mt=":host{display:block}.wrapper{display:flex}.wrapper>div{align-self:center;margin-right:10px}";const vt=class{constructor(i){t(this,i);this.arcgisHubIdentitySignedIn=e(this,"arcgisHubIdentitySignedIn",7);this.clientId=null;this.redirect=null;this.portalUrl="https://www.arcgis.com";this.user=null;this.origin=null}async componentWillLoad(){r.app={client:this.clientId,redirect:this.redirect,portal:this.portalUrl};if(!!this.origin){const t=await N.fromParent(this.origin);try{const e=await ht.create({authentication:t});r.context=e.context;this.arcgisHubIdentitySignedIn.emit(r.context)}catch(t){console.debug("arcgis-hub-identity: Embedded session not found",t)}}}signinClick(){const t=new CustomEvent("arcgisAppIdentityStartSignIn");document.dispatchEvent(t)}signoutClick(){const t=new CustomEvent("arcgisAppIdentityStartSignOut");document.dispatchEvent(t)}signedinEvent(t){var e,i;const n=(i=(e=r===null||r===void 0?void 0:r.context)===null||e===void 0?void 0:e._authentication)===null||i===void 0?void 0:i._tokenExpires;const s=new Date;if(n<s){const t=new CustomEvent("arcgisAppIdentityStartSignOut");document.dispatchEvent(t)}else{r.context=t.detail;console.debug("arcgis-hub-identity: arcgisAppIdentitySignedIn");this.arcgisHubIdentitySignedIn.emit(t.detail)}}signedoutEvent(t){r.context=null}render(){return i(n,null,i("span",{id:"profile"},i("arcgis-app-identity",{ref:t=>this.identityEl=t,"client-id":r.app.client,"redirect-uri":r.app.redirect,portal:r.app.portal},i("slot",null)),this.renderIdentity()))}renderIdentity(){var t;if(!!r.user){return(t=r.user)===null||t===void 0?void 0:t.fullName}else{return[i("div",{class:"wrapper"},i("div",null,"Sign in:"),i("calcite-button",{ref:t=>this.signinButton=t,onClick:this.signinClick},"Sign In"))]}}};vt.style=mt;export{vt as arcgis_hub_identity};
//# sourceMappingURL=p-cbc07df7.entry.js.map